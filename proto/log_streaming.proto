syntax = "proto3";

package ottoscaler.v1;

option go_package = "github.com/Team-5-CodeCat/ottoscaler/pkg/proto/v1";

/*
 * OttoscalerService - Otto-handlerì—ì„œ Ottoscalerë¡œì˜ ìŠ¤ì¼€ì¼ë§ ëª…ë ¹ ì„œë¹„ìŠ¤
 * 
 * ğŸ¯ ëª©ì :
 * - Otto-handlerê°€ Ottoscalerì—ê²Œ Worker Pod ìŠ¤ì¼€ì¼ë§ ëª…ë ¹ì„ ì „ì†¡
 * - ìŠ¤ì¼€ì¼ë§ ìš”ì²­ì— ëŒ€í•œ ë™ê¸°ì  ì‘ë‹µ ì²˜ë¦¬
 * - Worker Pod ìƒíƒœ ì¡°íšŒ ê¸°ëŠ¥
 * 
 * ğŸ“Š í†µì‹  íŒ¨í„´:
 * 1. Otto-handler â†’ ScaleUp/ScaleDown í˜¸ì¶œ â†’ Ottoscalerê°€ Worker Pod ì²˜ë¦¬
 * 2. Otto-handler â†’ GetWorkerStatus í˜¸ì¶œ â†’ í˜„ì¬ Worker ìƒíƒœ ë°˜í™˜
 */
service OttoscalerService {
    /*
     * ScaleUp - Worker Podë¥¼ ìƒì„±í•˜ì—¬ ìŠ¤ì¼€ì¼ ì—…
     * 
     * ğŸ“ ë™ì‘ ë°©ì‹:
     * - Otto-handlerê°€ ìƒˆë¡œìš´ CI/CD ì‘ì—… ì‹œì‘ ì‹œ í˜¸ì¶œ
     * - Ottoscalerê°€ ì§€ì •ëœ ê°œìˆ˜ë§Œí¼ Worker Pod ìƒì„±
     * - ìƒì„±ëœ Worker Pod ì •ë³´ë¥¼ ì‘ë‹µìœ¼ë¡œ ë°˜í™˜
     */
    rpc ScaleUp(ScaleRequest) returns (ScaleResponse);
    
    /*
     * ScaleDown - Worker Podë¥¼ ì¢…ë£Œí•˜ì—¬ ìŠ¤ì¼€ì¼ ë‹¤ìš´
     * 
     * ğŸ“ ë™ì‘ ë°©ì‹:
     * - Otto-handlerê°€ CI/CD ì‘ì—… ì™„ë£Œ ë˜ëŠ” ì·¨ì†Œ ì‹œ í˜¸ì¶œ
     * - Ottoscalerê°€ ì§€ì •ëœ Worker Podë“¤ì„ ì •ë¦¬
     */
    rpc ScaleDown(ScaleRequest) returns (ScaleResponse);
    
    /*
     * GetWorkerStatus - í˜„ì¬ Worker Pod ìƒíƒœ ì¡°íšŒ
     * 
     * ğŸ“ ë™ì‘ ë°©ì‹:
     * - Otto-handlerê°€ Worker ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì‹¶ì„ ë•Œ í˜¸ì¶œ
     * - í™œì„± ìƒíƒœì¸ Worker Pod ëª©ë¡ê³¼ ìƒíƒœ ì •ë³´ ë°˜í™˜
     */
    rpc GetWorkerStatus(WorkerStatusRequest) returns (WorkerStatusResponse);
    
    /*
     * ExecutePipeline - CI/CD Pipeline ì‹¤í–‰
     * 
     * ğŸ“ ë™ì‘ ë°©ì‹:
     * - Otto-handlerê°€ ì „ì²´ Pipeline (build, test, deploy ë“±)ì„ ì „ë‹¬
     * - Ottoscalerê°€ Stage ì˜ì¡´ì„±ì„ íŒŒì•…í•˜ì—¬ ìˆœì°¨/ë³‘ë ¬ ì‹¤í–‰
     * - ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™©ì„ ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ë°˜í™˜
     */
    rpc ExecutePipeline(PipelineRequest) returns (stream PipelineProgress);
}

/*
 * LogStreamingService - Worker Podì—ì„œ NestJS ì„œë²„ë¡œì˜ ì‹¤ì‹œê°„ ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤
 * 
 * ğŸ¯ ëª©ì :
 * - Worker Podì˜ stdout/stderr ë¡œê·¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ NestJS ì„œë²„ì— ì „ì†¡
 * - ì–‘ë°©í–¥ ìŠ¤íŠ¸ë¦¬ë°ì„ í†µí•œ íš¨ìœ¨ì ì¸ ë¡œê·¸ ì „ì†¡ ë° í”¼ë“œë°± ì²˜ë¦¬
 * - Worker Pod ë“±ë¡ ë° ì„¤ì • ê´€ë¦¬
 * 
 * ğŸ“Š í†µì‹  íŒ¨í„´:
 * 1. Worker Pod ì‹œì‘ â†’ RegisterWorker() í˜¸ì¶œ â†’ ì„¸ì…˜ ì„¤ì • ë°›ê¸°
 * 2. ë¡œê·¸ ìƒì„± ì‹œë§ˆë‹¤ â†’ StreamLogs() ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì „ì†¡ â†’ ì‘ë‹µ ë°›ê¸°
 * 3. Worker Pod ì¢…ë£Œ ì‹œ â†’ ìŠ¤íŠ¸ë¦¼ ì—°ê²° ìë™ ì¢…ë£Œ
 */
/*
 * OttoHandlerLogService - Ottoscalerì—ì„œ Otto-handlerë¡œì˜ ë¡œê·¸ ì „ë‹¬ ì„œë¹„ìŠ¤
 * 
 * ğŸ¯ ëª©ì :
 * - Ottoscalerê°€ ìˆ˜ì§‘í•œ Worker Pod ë¡œê·¸ë¥¼ Otto-handlerë¡œ ì „ë‹¬
 * - Otto-handlerì—ì„œ ë¡œê·¸ë¥¼ ë°›ì•„ ì›¹ ì¸í„°í˜ì´ìŠ¤ì— í‘œì‹œ
 * - ì‹¤ì‹œê°„ ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë°ì„ í†µí•œ CI/CD ì‘ì—… ëª¨ë‹ˆí„°ë§
 * 
 * ğŸ“Š í†µì‹  íŒ¨í„´:
 * 1. Ottoscaler â†’ ForwardWorkerLogs() ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë¡œê·¸ ì „ì†¡
 * 2. Otto-handler â†’ LogForwardResponseë¡œ ì²˜ë¦¬ ìƒíƒœ ì‘ë‹µ
 */
service OttoHandlerLogService {
    /*
     * ForwardWorkerLogs - Worker Pod ë¡œê·¸ë¥¼ Otto-handlerë¡œ ì „ë‹¬
     * 
     * ğŸ“ ë™ì‘ ë°©ì‹:
     * - Client (Ottoscaler): WorkerLogEntryë¥¼ ì§€ì†ì ìœ¼ë¡œ ì „ì†¡
     * - Server (Otto-handler): LogForwardResponseë¡œ ì²˜ë¦¬ ìƒíƒœ ì‘ë‹µ
     * 
     * ğŸ”„ ìŠ¤íŠ¸ë¦¼ ë¼ì´í”„ì‚¬ì´í´:
     * 1. Ottoscalerê°€ Worker Pod ë¡œê·¸ ìˆ˜ì§‘ ì‹œì‘
     * 2. ë¡œê·¸ ë°œìƒ ì‹œë§ˆë‹¤ WorkerLogEntry ì „ì†¡
     * 3. Otto-handlerê°€ LogForwardResponseë¡œ ACK/RETRY ì‘ë‹µ
     * 4. Worker ì‘ì—… ì™„ë£Œ ì‹œ ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ
     */
    rpc ForwardWorkerLogs(stream WorkerLogEntry) returns (stream LogForwardResponse);
    
    /*
     * NotifyWorkerStatus - Worker Pod ìƒíƒœ ë³€ê²½ ì•Œë¦¼
     * 
     * ğŸ“ ë™ì‘ ë°©ì‹:
     * - Ottoscalerì—ì„œ Worker Pod ìƒíƒœ ë³€ê²½ ì‹œ í˜¸ì¶œ
     * - Otto-handlerì—ì„œ ìƒíƒœë¥¼ ë°›ì•„ UI ì—…ë°ì´íŠ¸
     */
    rpc NotifyWorkerStatus(WorkerStatusNotification) returns (WorkerStatusAck);
}

service LogStreamingService {
    /*
     * StreamLogs - ì–‘ë°©í–¥ ìŠ¤íŠ¸ë¦¬ë° RPCë¡œ ë¡œê·¸ ì „ì†¡
     * 
     * ğŸ“ ë™ì‘ ë°©ì‹:
     * - Client (Worker Pod): LogEntry ë©”ì‹œì§€ë¥¼ ì§€ì†ì ìœ¼ë¡œ ì „ì†¡
     * - Server (NestJS): LogResponseë¡œ ì²˜ë¦¬ ìƒíƒœ ì‘ë‹µ
     * - ì—°ê²°ì´ ëŠì–´ì§€ë©´ ìë™ìœ¼ë¡œ ì¬ì—°ê²° ì‹œë„
     * 
     * ğŸ”„ ìŠ¤íŠ¸ë¦¼ ë¼ì´í”„ì‚¬ì´í´:
     * 1. Worker Podê°€ ìŠ¤íŠ¸ë¦¼ ì—°ê²° ì‹œì‘
     * 2. ë¡œê·¸ ë°œìƒ ì‹œë§ˆë‹¤ LogEntry ì „ì†¡
     * 3. ì„œë²„ê°€ LogResponseë¡œ ACK/RETRY/DROP ì‘ë‹µ
     * 4. Worker ì‘ì—… ì™„ë£Œ ì‹œ ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ
     */
    rpc StreamLogs(stream LogEntry) returns (stream LogResponse);
    
    /*
     * RegisterWorker - Worker Pod ì‹œì‘ ì‹œ ì„œë²„ì— ë“±ë¡
     * 
     * ğŸ“‹ ë“±ë¡ í”„ë¡œì„¸ìŠ¤:
     * 1. Worker Podê°€ ì‹œì‘ë˜ë©´ ì¦‰ì‹œ í˜¸ì¶œ
     * 2. Worker ë©”íƒ€ë°ì´í„°ì™€ ì‘ì—… ì •ë³´ ì „ì†¡
     * 3. ì„œë²„ì—ì„œ ì„¸ì…˜ IDì™€ ë¡œê¹… ì„¤ì • ë°˜í™˜
     * 4. ì´í›„ StreamLogsì—ì„œ ì„¸ì…˜ ID ì‚¬ìš©
     */
    rpc RegisterWorker(WorkerRegistration) returns (RegistrationResponse);
}

/*
 * LogEntry - Worker Podì—ì„œ ìƒì„±ë˜ëŠ” ë‹¨ì¼ ë¡œê·¸ ì—”íŠ¸ë¦¬
 * 
 * ğŸ“ ë¡œê·¸ êµ¬ì¡° ì„¤ëª…:
 * - Worker Podì˜ stdout/stderrì—ì„œ ìºì¹˜ëœ í•œ ì¤„ì˜ ë¡œê·¸ë¥¼ í‘œí˜„
 * - ì‹œê°„ ì •ë³´ì™€ í•¨ê»˜ êµ¬ì¡°í™”ëœ í˜•íƒœë¡œ ì „ì†¡
 * - NestJS ì„œë²„ì—ì„œ íŒŒì‹±í•˜ì—¬ ì›¹ ì¸í„°í˜ì´ìŠ¤ì— ì‹¤ì‹œê°„ í‘œì‹œ
 * 
 * ğŸ” ì‚¬ìš© ì˜ˆì‹œ:
 * {
 *   "worker_id": "otto-agent-1-abc123",
 *   "task_id": "task-456", 
 *   "timestamp": "2025-09-01T12:34:56.789Z",
 *   "level": "INFO",
 *   "source": "stdout",
 *   "message": "Task processing started...",
 *   "metadata": {"step": "initialization"}
 * }
 */
message LogEntry {
    // Worker Podì˜ ê³ ìœ  ì‹ë³„ì (ì˜ˆ: "otto-agent-1-abc123")
    // Main Podì—ì„œ ìƒì„±í•œ Worker Podì˜ ì´ë¦„ê³¼ ì¼ì¹˜í•´ì•¼ í•¨
    string worker_id = 1;
    
    // Redis ì´ë²¤íŠ¸ì—ì„œ ì˜¨ ì‘ì—… ì‹ë³„ì (ì˜ˆ: "task-456")
    // ì–´ë–¤ scale_up ì´ë²¤íŠ¸ë¡œ ì¸í•´ ìƒì„±ëœ ì‘ì—…ì¸ì§€ ì¶”ì 
    string task_id = 2;
    
    // ë¡œê·¸ ìƒì„± ì‹œê°„ (RFC3339 í˜•ì‹: "2025-09-01T12:34:56.789Z")
    // Worker Pod ë‚´ë¶€ì—ì„œ ë¡œê·¸ê°€ ì‹¤ì œë¡œ ë°œìƒí•œ ì‹œì 
    string timestamp = 3;
    
    // ë¡œê·¸ ë ˆë²¨ (INFO, ERROR, DEBUG, WARN ë“±)
    // ë¡œê·¸ì˜ ì¤‘ìš”ë„ë‚˜ ìœ í˜•ì„ ë‚˜íƒ€ëƒ„
    string level = 4;
    
    // ë¡œê·¸ ì†ŒìŠ¤ (stdout, stderr)
    // í‘œì¤€ ì¶œë ¥ì¸ì§€ ì—ëŸ¬ ì¶œë ¥ì¸ì§€ êµ¬ë¶„
    string source = 5;
    
    // ì‹¤ì œ ë¡œê·¸ ë©”ì‹œì§€ ë‚´ìš© (cmdì°½ì— ì¶œë ¥ë˜ëŠ” í•œ ì¤„)
    // Worker Podì˜ ì‘ì—… ì§„í–‰ ìƒí™©, ì—ëŸ¬, ë””ë²„ê·¸ ì •ë³´ ë“±
    string message = 6;
    
    // ì¶”ê°€ ë©”íƒ€ë°ì´í„° (ì„ íƒì )
    // ì‘ì—… ë‹¨ê³„, íŒŒì¼ëª…, í•¨ìˆ˜ëª… ë“± ë¶€ê°€ ì •ë³´
    map<string, string> metadata = 7;
}

/*
 * LogResponse - NestJS ì„œë²„ì—ì„œ Worker Podë¡œì˜ ì‘ë‹µ ë©”ì‹œì§€
 * 
 * ğŸ”„ ì‘ë‹µ ì²˜ë¦¬ ë¡œì§:
 * - ACK: ë¡œê·¸ ì„±ê³µì ìœ¼ë¡œ ë°›ìŒ, ë‹¤ìŒ ë¡œê·¸ ì „ì†¡ ê°€ëŠ¥
 * - RETRY: ì¼ì‹œì  ì‹¤íŒ¨, ê°™ì€ ë¡œê·¸ë¥¼ ë‹¤ì‹œ ì „ì†¡ í•„ìš”
 * - DROP: ì˜êµ¬ì  ì‹¤íŒ¨, í•´ë‹¹ ë¡œê·¸ í¬ê¸°í•˜ê³  ë‹¤ìŒìœ¼ë¡œ ì§„í–‰
 * 
 * ğŸ“Š ë°±í”„ë ˆì…”(Backpressure) ì²˜ë¦¬:
 * - ì„œë²„ ê³¼ë¶€í•˜ ì‹œ RETRY ì‘ë‹µìœ¼ë¡œ Worker Pod ì „ì†¡ ì†ë„ ì¡°ì ˆ
 * - sequence ë²ˆí˜¸ë¡œ ë¡œê·¸ ìˆœì„œ ë³´ì¥
 */
message LogResponse {
    /*
     * Status - ë¡œê·¸ ì²˜ë¦¬ ê²°ê³¼ ìƒíƒœ
     * 
     * âœ… ACK (0): ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë¨
     * ğŸ”„ RETRY (1): ì¼ì‹œì  ì˜¤ë¥˜, ì¬ì‹œë„ í•„ìš” (ë„¤íŠ¸ì›Œí¬ ì§€ì—°, ì„œë²„ ë¶€í•˜ ë“±)
     * âŒ DROP (2): ì˜êµ¬ì  ì˜¤ë¥˜, í•´ë‹¹ ë¡œê·¸ í¬ê¸° (ì˜ëª»ëœ í˜•ì‹, ê¶Œí•œ ì—†ìŒ ë“±)
     */
    enum Status {
        ACK = 0;        // ì„±ê³µì ìœ¼ë¡œ ë°›ê³  ì²˜ë¦¬í•¨
        RETRY = 1;      // ì¼ì‹œì  ì‹¤íŒ¨, ì¬ì‹œë„ ìš”ì²­
        DROP = 2;       // ì˜êµ¬ì  ì‹¤íŒ¨, ë¡œê·¸ í¬ê¸°
    }
    
    // ë¡œê·¸ ì²˜ë¦¬ ê²°ê³¼ ìƒíƒœ
    Status status = 1;
    
    // ë””ë²„ê¹…ìš© ë©”ì‹œì§€ (ì„ íƒì )
    // ì—ëŸ¬ ì´ìœ ë‚˜ ì¶”ê°€ ì •ë³´ ì œê³µ
    string message = 2;
    
    // ìˆœì„œ ë³´ì¥ì„ ìœ„í•œ ì‹œí€€ìŠ¤ ë²ˆí˜¸ (ì„ íƒì )
    // ë¡œê·¸ ì „ì†¡ ìˆœì„œì™€ ì²˜ë¦¬ ìˆœì„œ ë§¤ì¹­
    int64 sequence = 3;
}

// WorkerRegistration contains information about a starting worker
message WorkerRegistration {
    // Worker pod identifier
    string worker_id = 1;
    
    // Task identifier this worker is handling
    string task_id = 2;
    
    // Worker pod metadata
    WorkerMetadata metadata = 3;
    
    // NestJS server endpoint (for health checks)
    string server_endpoint = 4;
}

// WorkerMetadata contains Kubernetes pod information
message WorkerMetadata {
    // Pod name in Kubernetes
    string pod_name = 1;
    
    // Kubernetes namespace
    string namespace = 2;
    
    // Node where pod is running
    string node_name = 3;
    
    // Pod creation timestamp
    string created_at = 4;
    
    // Labels applied to the pod
    map<string, string> labels = 5;
}

// RegistrationResponse confirms worker registration
message RegistrationResponse {
    enum Status {
        SUCCESS = 0;
        ALREADY_REGISTERED = 1;
        SERVER_FULL = 2;
        INVALID_REQUEST = 3;
    }
    
    Status status = 1;
    string message = 2;
    
    // Server-assigned session ID for this worker
    string session_id = 3;
    
    // Recommended logging configuration
    LoggingConfig config = 4;
}

// LoggingConfig contains server preferences for logging
message LoggingConfig {
    // Maximum logs per second from this worker
    int32 rate_limit = 1;
    
    // Buffer size for batching logs
    int32 buffer_size = 2;
    
    // Maximum message size in bytes
    int32 max_message_size = 3;
    
    // Whether to include full metadata
    bool include_metadata = 4;
}

/*
 * ===== SCALING SERVICE MESSAGES =====
 * 
 * ìŠ¤ì¼€ì¼ë§ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë©”ì‹œì§€ íƒ€ì…ë“¤
 * Otto-handler â†” Ottoscaler ê°„ì˜ ìŠ¤ì¼€ì¼ë§ ìš”ì²­/ì‘ë‹µ
 */

// ScaleRequest - ìŠ¤ì¼€ì¼ë§ ìš”ì²­ ë©”ì‹œì§€
message ScaleRequest {
    // ì‘ì—… ê³ ìœ  ì‹ë³„ì (CI/CD ì‘ì—… ID)
    string task_id = 1;
    
    // Git ì €ì¥ì†Œ URL
    string repository = 2;
    
    // Git ì»¤ë°‹ SHA
    string commit_sha = 3;
    
    // ìŠ¤ì¼€ì¼ë§í•  Worker Pod ìˆ˜ (scale_up ì‹œ ìƒì„±í•  ìˆ˜, scale_down ì‹œ ëª©í‘œ ìˆ˜)
    int32 worker_count = 4;
    
    // CI/CD ë¹Œë“œ ì„¤ì • (í™˜ê²½ ë³€ìˆ˜, ëª…ë ¹ì–´ ë“±)
    map<string, string> build_config = 5;
    
    // ìš”ì²­ì„ ì‹œì‘í•œ ì£¼ì²´ (ì‚¬ìš©ì ë˜ëŠ” ì‹œìŠ¤í…œ)
    string triggered_by = 6;
    
    // ìŠ¤ì¼€ì¼ë§ ìš”ì²­ ì‚¬ìœ 
    string reason = 7;
    
    // ì¶”ê°€ ë©”íƒ€ë°ì´í„°
    map<string, string> metadata = 8;
}

// ScaleResponse - ìŠ¤ì¼€ì¼ë§ ì‘ë‹µ ë©”ì‹œì§€  
message ScaleResponse {
    enum Status {
        SUCCESS = 0;           // ì„±ê³µ
        FAILED = 1;            // ì‹¤íŒ¨
        PARTIAL_SUCCESS = 2;   // ë¶€ë¶„ ì„±ê³µ (ì¼ë¶€ Podë§Œ ì²˜ë¦¬ë¨)
        ALREADY_PROCESSED = 3; // ì´ë¯¸ ì²˜ë¦¬ëœ ìš”ì²­
    }
    
    // ì‘ë‹µ ìƒíƒœ
    Status status = 1;
    
    // ì‘ë‹µ ë©”ì‹œì§€ (ì—ëŸ¬ ì •ë³´ ë˜ëŠ” ì„±ê³µ ë©”ì‹œì§€)
    string message = 2;
    
    // ì‹¤ì œë¡œ ì²˜ë¦¬ëœ Worker Pod ìˆ˜
    int32 processed_count = 3;
    
    // ìƒì„±/ì‚­ì œëœ Worker Pod ëª©ë¡
    repeated string worker_pod_names = 4;
    
    // ì²˜ë¦¬ ì‹œì‘ ì‹œê°„ (RFC3339 í˜•ì‹)
    string started_at = 5;
    
    // ì²˜ë¦¬ ì™„ë£Œ ì‹œê°„ (RFC3339 í˜•ì‹)
    string completed_at = 6;
}

// WorkerStatusRequest - Worker ìƒíƒœ ì¡°íšŒ ìš”ì²­
message WorkerStatusRequest {
    // íŠ¹ì • ì‘ì—… IDë¡œ í•„í„°ë§ (ë¹„ì–´ìˆìœ¼ë©´ ì „ì²´ ì¡°íšŒ)
    string task_id = 1;
    
    // íŠ¹ì • Worker Pod ì´ë¦„ìœ¼ë¡œ í•„í„°ë§
    string worker_pod_name = 2;
    
    // ìƒíƒœë¡œ í•„í„°ë§ ("running", "pending", "succeeded", "failed")
    string status_filter = 3;
}

// WorkerStatusResponse - Worker ìƒíƒœ ì¡°íšŒ ì‘ë‹µ
message WorkerStatusResponse {
    // ì „ì²´ Worker Pod ìˆ˜
    int32 total_count = 1;
    
    // ìƒíƒœë³„ Worker Pod ìˆ˜
    int32 running_count = 2;
    int32 pending_count = 3;
    int32 succeeded_count = 4;
    int32 failed_count = 5;
    
    // Worker Pod ìƒì„¸ ì •ë³´ ëª©ë¡
    repeated WorkerPodStatus workers = 6;
}

// WorkerPodStatus - ê°œë³„ Worker Pod ìƒíƒœ ì •ë³´
message WorkerPodStatus {
    // Pod ì´ë¦„
    string pod_name = 1;
    
    // ì‘ì—… ID
    string task_id = 2;
    
    // Pod ìƒíƒœ ("pending", "running", "succeeded", "failed")
    string status = 3;
    
    // Pod ìƒì„± ì‹œê°„
    string created_at = 4;
    
    // Pod ì‹œì‘ ì‹œê°„
    string started_at = 5;
    
    // Pod ì™„ë£Œ ì‹œê°„ (ì™„ë£Œëœ ê²½ìš°)
    string completed_at = 6;
    
    // ì‹¤í–‰ ì¤‘ì¸ ë…¸ë“œ
    string node_name = 7;
    
    // Pod IP
    string pod_ip = 8;
    
    // ì¶”ê°€ ë¼ë²¨
    map<string, string> labels = 9;
    
    // ì—ëŸ¬ ë©”ì‹œì§€ (ì‹¤íŒ¨í•œ ê²½ìš°)
    string error_message = 10;
}

/*
 * ===== OTTO-HANDLER LOG SERVICE MESSAGES =====
 * 
 * Ottoscalerì—ì„œ Otto-handlerë¡œ ë¡œê·¸ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•œ ë©”ì‹œì§€ íƒ€ì…ë“¤
 */

// WorkerLogEntry - Ottoscalerì—ì„œ Otto-handlerë¡œ ì „ë‹¬í•˜ëŠ” Worker ë¡œê·¸ ì—”íŠ¸ë¦¬
message WorkerLogEntry {
    // Worker Podì˜ ê³ ìœ  ì‹ë³„ì
    string worker_id = 1;
    
    // ì‘ì—… ì‹ë³„ì (CI/CD ì‘ì—… ID)
    string task_id = 2;
    
    // ë¡œê·¸ ìƒì„± ì‹œê°„ (RFC3339 í˜•ì‹)
    string timestamp = 3;
    
    // ë¡œê·¸ ë ˆë²¨ (INFO, ERROR, DEBUG, WARN)
    string level = 4;
    
    // ë¡œê·¸ ì†ŒìŠ¤ (stdout, stderr)
    string source = 5;
    
    // ì‹¤ì œ ë¡œê·¸ ë©”ì‹œì§€ ë‚´ìš©
    string message = 6;
    
    // Pod ê´€ë ¨ ë©”íƒ€ë°ì´í„°
    WorkerMetadata pod_metadata = 7;
    
    // ì¶”ê°€ ë©”íƒ€ë°ì´í„°
    map<string, string> metadata = 8;
}

// LogForwardResponse - Otto-handlerì—ì„œ Ottoscalerë¡œì˜ ë¡œê·¸ ì²˜ë¦¬ ì‘ë‹µ
message LogForwardResponse {
    enum Status {
        ACK = 0;        // ì„±ê³µì ìœ¼ë¡œ ë°›ê³  ì²˜ë¦¬í•¨
        RETRY = 1;      // ì¼ì‹œì  ì‹¤íŒ¨, ì¬ì‹œë„ ìš”ì²­
        DROP = 2;       // ì˜êµ¬ì  ì‹¤íŒ¨, ë¡œê·¸ í¬ê¸°
    }
    
    // ë¡œê·¸ ì²˜ë¦¬ ê²°ê³¼ ìƒíƒœ
    Status status = 1;
    
    // ì‘ë‹µ ë©”ì‹œì§€ (ì—ëŸ¬ ì •ë³´ ë˜ëŠ” ì„±ê³µ ë©”ì‹œì§€)
    string message = 2;
    
    // ìˆœì„œ ë³´ì¥ì„ ìœ„í•œ ì‹œí€€ìŠ¤ ë²ˆí˜¸
    int64 sequence = 3;
    
    // ë°±í”„ë ˆì…” ì œì–´: ë‹¤ìŒ ë¡œê·¸ê¹Œì§€ ëŒ€ê¸° ì‹œê°„ (ms)
    int32 throttle_ms = 4;
}

// WorkerStatusNotification - Worker Pod ìƒíƒœ ë³€ê²½ ì•Œë¦¼
message WorkerStatusNotification {
    enum StatusType {
        CREATED = 0;     // Pod ìƒì„±ë¨
        RUNNING = 1;     // Pod ì‹¤í–‰ ì¤‘
        COMPLETED = 2;   // Pod ì„±ê³µ ì™„ë£Œ
        FAILED = 3;      // Pod ì‹¤íŒ¨
        TERMINATED = 4;  // Pod ê°•ì œ ì¢…ë£Œ
    }
    
    // Worker Pod ì´ë¦„
    string worker_id = 1;
    
    // ì‘ì—… ID
    string task_id = 2;
    
    // ìƒíƒœ íƒ€ì…
    StatusType status = 3;
    
    // ìƒíƒœ ë³€ê²½ ì‹œê°„
    string timestamp = 4;
    
    // ìƒíƒœ ë³€ê²½ ì´ìœ /ë©”ì‹œì§€
    string reason = 5;
    
    // ì¶”ê°€ ë©”íƒ€ë°ì´í„°
    map<string, string> metadata = 6;
}

// WorkerStatusAck - Worker ìƒíƒœ ì•Œë¦¼ì— ëŒ€í•œ ì‘ë‹µ
message WorkerStatusAck {
    enum Status {
        RECEIVED = 0;    // ì„±ê³µì ìœ¼ë¡œ ë°›ìŒ
        IGNORED = 1;     // ë¬´ì‹œë¨ (ì¤‘ë³µ ë“±)
        ERROR = 2;       // ì²˜ë¦¬ ì¤‘ ì—ëŸ¬
    }
    
    Status status = 1;
    string message = 2;
}

// ============================================================================
// Pipeline Execution Messages
// ============================================================================

// PipelineRequest - Pipeline ì‹¤í–‰ ìš”ì²­
message PipelineRequest {
    // Pipeline ê³ ìœ  ID
    string pipeline_id = 1;
    
    // Pipeline ì´ë¦„ (ì˜ˆ: "Full CI/CD", "Build and Test")
    string name = 2;
    
    // Pipelineì„ êµ¬ì„±í•˜ëŠ” Stageë“¤
    repeated PipelineStage stages = 3;
    
    // Repository ì •ë³´
    string repository = 4;
    
    // Commit SHA
    string commit_sha = 5;
    
    // íŠ¸ë¦¬ê±°í•œ ì‚¬ìš©ì/ì‹œìŠ¤í…œ
    string triggered_by = 6;
    
    // Pipeline ë©”íƒ€ë°ì´í„°
    map<string, string> metadata = 7;
}

// PipelineStage - Pipelineì„ êµ¬ì„±í•˜ëŠ” ê°œë³„ Stage
message PipelineStage {
    // Stage ID (ì˜ˆ: "build", "unit-test", "deploy-staging")
    string stage_id = 1;
    
    // Stage íƒ€ì… ("build", "test", "deploy", "custom")
    string type = 2;
    
    // Stage ì´ë¦„
    string name = 3;
    
    // ì´ Stageë¥¼ ìœ„í•œ Worker ìˆ˜
    int32 worker_count = 4;
    
    // ì˜ì¡´í•˜ëŠ” Stage ID ëª©ë¡ (ë³‘ë ¬ ì‹¤í–‰ ê°€ëŠ¥ íŒë‹¨ìš©)
    repeated string depends_on = 5;
    
    // Stageë³„ ì„¤ì • (í™˜ê²½ë³€ìˆ˜, íŒŒë¼ë¯¸í„° ë“±)
    map<string, string> config = 6;
    
    // ì‚¬ìš©í•  ì´ë¯¸ì§€ (ë¹„ì–´ìˆìœ¼ë©´ ê¸°ë³¸ ì´ë¯¸ì§€ ì‚¬ìš©)
    string image = 7;
    
    // ì‹¤í–‰í•  ëª…ë ¹ì–´
    repeated string command = 8;
    
    // ëª…ë ¹ì–´ ì¸ì
    repeated string args = 9;
    
    // íƒ€ì„ì•„ì›ƒ (ì´ˆ ë‹¨ìœ„, 0ì´ë©´ ë¬´ì œí•œ)
    int32 timeout_seconds = 10;
    
    // ì¬ì‹œë„ ì •ì±…
    RetryPolicy retry_policy = 11;
}

// RetryPolicy - Stage ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ì •ì±…
message RetryPolicy {
    // ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜
    int32 max_attempts = 1;
    
    // ì¬ì‹œë„ ê°„ê²© (ì´ˆ)
    int32 retry_delay_seconds = 2;
    
    // ì¬ì‹œë„ ê°€ëŠ¥í•œ ì‹¤íŒ¨ ìœ í˜•
    repeated string retryable_failures = 3;
}

// PipelineProgress - Pipeline ì‹¤í–‰ ì§„í–‰ ìƒí™©
message PipelineProgress {
    // Pipeline ID
    string pipeline_id = 1;
    
    // í˜„ì¬ Stage ID
    string stage_id = 2;
    
    // Stage ìƒíƒœ
    StageStatus status = 3;
    
    // ìƒíƒœ ë©”ì‹œì§€
    string message = 4;
    
    // ì´ Stageë¥¼ ìœ„í•´ ìƒì„±ëœ Worker Pod ì´ë¦„ë“¤
    repeated string worker_pod_names = 5;
    
    // ì§„í–‰ë¥  (0-100)
    int32 progress_percentage = 6;
    
    // íƒ€ì„ìŠ¤íƒ¬í”„
    string timestamp = 7;
    
    // Stage ì‹œì‘ ì‹œê°„
    string started_at = 8;
    
    // Stage ì™„ë£Œ ì‹œê°„ (ì™„ë£Œëœ ê²½ìš°)
    string completed_at = 9;
    
    // ì—ëŸ¬ ì •ë³´ (ì‹¤íŒ¨í•œ ê²½ìš°)
    string error_message = 10;
    
    // Stage ë©”íŠ¸ë¦­
    StageMetrics metrics = 11;
}

// StageStatus - Pipeline Stage ìƒíƒœ
enum StageStatus {
    STAGE_PENDING = 0;     // ëŒ€ê¸° ì¤‘
    STAGE_RUNNING = 1;     // ì‹¤í–‰ ì¤‘
    STAGE_COMPLETED = 2;   // ì™„ë£Œ
    STAGE_FAILED = 3;      // ì‹¤íŒ¨
    STAGE_CANCELLED = 4;   // ì·¨ì†Œë¨
    STAGE_SKIPPED = 5;     // ê±´ë„ˆëœ€ (ì´ì „ Stage ì‹¤íŒ¨ë¡œ)
    STAGE_RETRYING = 6;    // ì¬ì‹œë„ ì¤‘
}

// StageMetrics - Stage ì‹¤í–‰ ë©”íŠ¸ë¦­
message StageMetrics {
    // ì‹¤í–‰ ì‹œê°„ (ì´ˆ)
    int32 duration_seconds = 1;
    
    // ì„±ê³µí•œ Worker ìˆ˜
    int32 successful_workers = 2;
    
    // ì‹¤íŒ¨í•œ Worker ìˆ˜
    int32 failed_workers = 3;
    
    // ì´ Worker ìˆ˜
    int32 total_workers = 4;
    
    // CPU ì‚¬ìš©ëŸ‰ (í‰ê· )
    float avg_cpu_usage = 5;
    
    // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (í‰ê· , MB)
    float avg_memory_mb = 6;
}